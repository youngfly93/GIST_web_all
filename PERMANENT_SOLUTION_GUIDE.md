# ğŸ› ï¸ å‰ç«¯è“å±é—®é¢˜ - æ°¸ä¹…è§£å†³æ–¹æ¡ˆæŒ‡å—

## ğŸ“‹ é—®é¢˜åˆ†æ

### ä¸ºä»€ä¹ˆä¼šåå¤å‡ºç°è“å±ï¼Ÿ

**æ ¹æœ¬åŸå› **ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Vite å¼€å‘æœåŠ¡å™¨ï¼ˆdev modeï¼‰

1. **Vite è¡Œä¸º**ï¼š
   - é»˜è®¤ç«¯å£ 5173
   - ç«¯å£è¢«å ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° 5174ã€5175...
   - å¼€å‘æ¨¡å¼ä¸‹ä¼šç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡å¯
   
2. **è¿›ç¨‹ç®¡ç†é—®é¢˜**ï¼š
   - é…ç½®æ–‡ä»¶æ”¹å˜æ—¶ Vite è‡ªåŠ¨é‡å¯
   - PM2 å¯èƒ½åˆ›å»ºå¤šä¸ªå®ä¾‹
   - æ—§è¿›ç¨‹æœªè¢«æ­£ç¡®æ¸…ç†

3. **Nginx é…ç½®**ï¼š
   - ç¡¬ç¼–ç ç«¯å£å·ï¼ˆ5173 æˆ– 5174ï¼‰
   - æ— æ³•åŠ¨æ€é€‚åº”ç«¯å£å˜åŒ–
   - å¯¼è‡´ä»£ç†å¤±è´¥ = è“å±

---

## âœ… æ°¸ä¹…è§£å†³æ–¹æ¡ˆ

### ğŸ† **æ–¹æ¡ˆ 1ï¼šç”Ÿäº§æ„å»ºæ¨¡å¼ï¼ˆæœ€æ¨èï¼‰**

**åŸç†**ï¼šå°†å‰ç«¯æ„å»ºæˆé™æ€æ–‡ä»¶ï¼ŒNginx ç›´æ¥æœåŠ¡ï¼Œä¸å†éœ€è¦ Node.js è¿›ç¨‹

#### ä¼˜ç‚¹
- âœ… **å®Œå…¨æ¶ˆé™¤ç«¯å£é—®é¢˜** - ä¸éœ€è¦ä»»ä½• Node.js è¿›ç¨‹
- âœ… **æ€§èƒ½æœ€ä½³** - é™æ€æ–‡ä»¶æœåŠ¡ï¼Œæå¿«å“åº”
- âœ… **èµ„æºå ç”¨æœ€ä½** - ä¸éœ€è¦å¸¸é©»è¿›ç¨‹
- âœ… **æœ€ç¨³å®š** - æ— è¿›ç¨‹å´©æºƒé£é™©
- âœ… **æ ‡å‡†åšæ³•** - è¿™æ‰æ˜¯ç”Ÿäº§ç¯å¢ƒçš„æ­£ç¡®æ–¹å¼

#### ç¼ºç‚¹
- âš ï¸ ä»£ç æ›´æ–°åéœ€è¦é‡æ–°æ„å»º
- âš ï¸ æ„å»ºéœ€è¦ 1-2 åˆ†é’Ÿ

#### ä½¿ç”¨æ–¹æ³•

```bash
# ä¸€é”®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
bash /home/ylab/GIST_web_all/deploy_frontend_production.sh
```

#### éƒ¨ç½²æµç¨‹
1. åœæ­¢æ‰€æœ‰ Vite å¼€å‘æœåŠ¡å™¨
2. æ„å»ºå‰ç«¯ (`npm run build`)
3. æ›´æ–° Nginx é…ç½®ï¼ŒæŒ‡å‘ `dist` ç›®å½•
4. é‡è½½ Nginx

#### å‰ç«¯æ›´æ–°æµç¨‹
```bash
# åœ¨æœ¬åœ°å¼€å‘
cd frontend
npm run dev  # http://localhost:5173

# å¼€å‘å®Œæˆåï¼Œéƒ¨ç½²åˆ°ç”Ÿäº§
bash /home/ylab/GIST_web_all/deploy_frontend_production.sh
```

---

### ğŸ¥ˆ **æ–¹æ¡ˆ 2ï¼šå›ºå®šç«¯å£ + ä¸¥æ ¼æ¨¡å¼**

**åŸç†**ï¼šé…ç½® Vite `strictPort: true`ï¼Œç«¯å£è¢«å ç”¨æ—¶ç›´æ¥å¤±è´¥è€Œä¸åˆ‡æ¢

#### ä¼˜ç‚¹
- âœ… ä¿ç•™çƒ­é‡è½½åŠŸèƒ½ï¼ˆå¼€å‘æ—¶æ–¹ä¾¿ï¼‰
- âœ… é˜²æ­¢ç«¯å£æ¼‚ç§»
- âœ… é—®é¢˜æ—©å‘ç°ï¼ˆç«¯å£å†²çªæ—¶ç«‹å³æŠ¥é”™ï¼‰

#### ç¼ºç‚¹
- âš ï¸ ä»éœ€å¸¸é©» Node.js è¿›ç¨‹
- âš ï¸ èµ„æºå ç”¨è¾ƒé«˜ï¼ˆ~100MB å†…å­˜ï¼‰
- âš ï¸ ä»å¯èƒ½æœ‰è¿›ç¨‹ç®¡ç†é—®é¢˜
- âš ï¸ ä¸æ˜¯ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

#### ä½¿ç”¨æ–¹æ³•

```bash
# é…ç½®å›ºå®šç«¯å£
bash /home/ylab/GIST_web_all/configure_vite_strict_port.sh
```

#### é…ç½®å†…å®¹ï¼ˆvite.config.tsï¼‰
```typescript
export default defineConfig({
  server: {
    port: 5173,
    strictPort: true,  // å…³é”®é…ç½®
    host: true,
  }
})
```

---

### ğŸ¥‰ **æ–¹æ¡ˆ 3ï¼šè¿›ç¨‹ç›‘æ§ + è‡ªåŠ¨ä¿®å¤**

**åŸç†**ï¼šå®šæœŸæ£€æŸ¥å¹¶è‡ªåŠ¨ä¿®å¤ç«¯å£å†²çª

#### ä¼˜ç‚¹
- âœ… è‡ªåŠ¨åŒ–è¿ç»´
- âœ… æ— éœ€æ‰‹åŠ¨ä»‹å…¥

#### ç¼ºç‚¹
- âš ï¸ æ²»æ ‡ä¸æ²»æœ¬
- âš ï¸ å¢åŠ ç³»ç»Ÿå¤æ‚åº¦
- âš ï¸ ä»ä¼šæœ‰çŸ­æš‚æœåŠ¡ä¸­æ–­

#### ä½¿ç”¨æ–¹æ³•

```bash
# æ·»åŠ åˆ° crontabï¼Œæ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
*/5 * * * * /home/ylab/GIST_web_all/fix_frontend_port.sh > /tmp/frontend_monitor.log 2>&1
```

---

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | æ–¹æ¡ˆ1ï¼šç”Ÿäº§æ„å»º | æ–¹æ¡ˆ2ï¼šå›ºå®šç«¯å£ | æ–¹æ¡ˆ3ï¼šç›‘æ§ä¿®å¤ |
|------|----------------|----------------|----------------|
| **ç¨³å®šæ€§** | â­â­â­â­â­ | â­â­â­ | â­â­ |
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­ | â­â­â­ |
| **èµ„æºå ç”¨** | â­â­â­â­â­ (æä½) | â­â­ (100MB+) | â­â­ (100MB+) |
| **å½»åº•æ€§** | â­â­â­â­â­ | â­â­â­ | â­ |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­â­ | â­â­â­ | â­â­ |
| **æ›´æ–°ä¾¿åˆ©æ€§** | â­â­â­ (éœ€é‡æ–°æ„å»º) | â­â­â­â­ (çƒ­é‡è½½) | â­â­â­â­ |
| **ç”Ÿäº§æ¨èåº¦** | â­â­â­â­â­ | â­â­ | â­ |

---

## ğŸ¯ æ¨èé€‰æ‹©

### å¯¹äºç”Ÿäº§ç¯å¢ƒï¼š**å¼ºçƒˆæ¨èæ–¹æ¡ˆ 1**

```bash
bash /home/ylab/GIST_web_all/deploy_frontend_production.sh
```

**åŸå› **ï¼š
1. âœ… è¿™æ˜¯è¡Œä¸šæ ‡å‡†åšæ³•
2. âœ… æœ€ç¨³å®šã€æœ€å¿«ã€èµ„æºå ç”¨æœ€ä½
3. âœ… å½»åº•è§£å†³é—®é¢˜ï¼Œä¸ä¼šå†å‡ºç°è“å±
4. âœ… ç¬¦åˆ React/Vue/Angular ç­‰ç°ä»£å‰ç«¯æ¡†æ¶çš„æœ€ä½³å®è·µ

### å¯¹äºå¼€å‘/æµ‹è¯•ç¯å¢ƒï¼šæ–¹æ¡ˆ 2

å¦‚æœä½ éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šé¢‘ç¹è°ƒè¯•å‰ç«¯ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ¡ˆ 2ã€‚

---

## ğŸ“ å®æ–½æ­¥éª¤ï¼ˆæ¨èï¼‰

### ç¬¬ä¸€æ­¥ï¼šç«‹å³éƒ¨ç½²ç”Ÿäº§ç‰ˆæœ¬

```bash
# æ‰§è¡Œç”Ÿäº§éƒ¨ç½²
bash /home/ylab/GIST_web_all/deploy_frontend_production.sh
```

### ç¬¬äºŒæ­¥ï¼šéªŒè¯

```bash
# 1. æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /home/ylab/GIST_web_all/frontend/dist/

# 2. æ£€æŸ¥ Nginx é…ç½®
grep "root.*dist" /etc/nginx/sites-available/dbgist

# 3. æµ‹è¯•è®¿é—®
curl -I https://www.dbgist.com/

# 4. ç¡®è®¤æ²¡æœ‰ Vite è¿›ç¨‹è¿è¡Œ
ps aux | grep vite | grep -v grep
# åº”è¯¥æ˜¯ç©ºçš„ï¼
```

### ç¬¬ä¸‰æ­¥ï¼šæ¸…ç†æ—§é…ç½®

```bash
# ç¡®è®¤ PM2 ä¸­æ²¡æœ‰å‰ç«¯æœåŠ¡
pm2 list
# gist-frontend åº”è¯¥æ˜¯ stopped æˆ–ä¸å­˜åœ¨

# ä¿å­˜ PM2 çŠ¶æ€
pm2 save
```

### ç¬¬å››æ­¥ï¼šæ–‡æ¡£å’Œæµç¨‹

å‰ç«¯ä»£ç æ›´æ–°æµç¨‹ï¼š
```bash
# 1. æœ¬åœ°å¼€å‘å’Œæµ‹è¯•
cd /home/ylab/GIST_web_all/frontend
npm run dev  # æœ¬åœ°æµ‹è¯•

# 2. å¼€å‘å®Œæˆåï¼Œæäº¤ä»£ç 
git add .
git commit -m "Update frontend"
git push

# 3. æœåŠ¡å™¨ä¸Šæ›´æ–°å¹¶éƒ¨ç½²
cd /home/ylab/GIST_web_all
git pull
bash deploy_frontend_production.sh
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### éƒ¨ç½²åæ— æ³•è®¿é—®ï¼Ÿ

```bash
# 1. æ£€æŸ¥æ„å»ºäº§ç‰©
ls -lh /home/ylab/GIST_web_all/frontend/dist/

# 2. æ£€æŸ¥ Nginx é”™è¯¯æ—¥å¿—
tail -50 /var/log/nginx/error.log

# 3. æµ‹è¯• Nginx é…ç½®
nginx -t

# 4. æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—
tail -50 /var/log/nginx/access.log
```

### å‰ç«¯æ˜¾ç¤ºæ—§å†…å®¹ï¼Ÿ

```bash
# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# Ctrl + Shift + Delete (Chrome/Firefox)
# Cmd + Shift + Delete (Safari)

# æˆ–è€…å¼ºåˆ¶åˆ·æ–°
# Ctrl + F5 (Windows/Linux)
# Cmd + Shift + R (Mac)
```

### éœ€è¦å›é€€åˆ°å¼€å‘æ¨¡å¼ï¼Ÿ

```bash
# 1. æ¢å¤æ—§çš„ Nginx é…ç½®
cp /etc/nginx/sites-available/dbgist.backup_XXXXXX /etc/nginx/sites-available/dbgist

# 2. é‡å¯å‰ç«¯æœåŠ¡
cd /home/ylab/GIST_web_all/frontend
pm2 start npm --name "gist-frontend" -- run dev

# 3. é‡è½½ Nginx
nginx -t && systemctl reload nginx
```

---

## ğŸ“š è¡¥å……è¯´æ˜

### ä¸ºä»€ä¹ˆç”Ÿäº§ç¯å¢ƒä¸åº”è¯¥ç”¨å¼€å‘æœåŠ¡å™¨ï¼Ÿ

1. **å¼€å‘æœåŠ¡å™¨çš„è®¾è®¡ç›®çš„**ï¼š
   - å¿«é€Ÿçƒ­é‡è½½ï¼ˆHMRï¼‰
   - æºç è°ƒè¯•
   - å¼€å‘ä½“éªŒä¼˜åŒ–

2. **ç”Ÿäº§ç¯å¢ƒçš„éœ€æ±‚**ï¼š
   - æœ€ä½³æ€§èƒ½
   - æœ€é«˜ç¨³å®šæ€§
   - æœ€å°èµ„æºå ç”¨
   - ä»£ç æ··æ·†å’Œå‹ç¼©

3. **å¼€å‘æ¨¡å¼çš„é—®é¢˜**ï¼š
   - åŒ…å«å¤§é‡è°ƒè¯•ä»£ç 
   - æœªå‹ç¼©ã€æœªä¼˜åŒ–
   - å®æ—¶ç¼–è¯‘ï¼Œæ€§èƒ½å·®
   - è¿›ç¨‹ç®¡ç†å¤æ‚

### Vite æ„å»ºåšäº†ä»€ä¹ˆï¼Ÿ

```bash
npm run build
```

1. **ä»£ç è½¬æ¢**ï¼š
   - TypeScript â†’ JavaScript
   - JSX â†’ JavaScript
   - ç°ä»£è¯­æ³• â†’ å…¼å®¹è¯­æ³•

2. **ä¼˜åŒ–**ï¼š
   - ä»£ç å‹ç¼©ï¼ˆMinifyï¼‰
   - Tree-shakingï¼ˆç§»é™¤æœªä½¿ç”¨ä»£ç ï¼‰
   - ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰
   - èµ„æºå†…è”

3. **äº§ç‰©**ï¼š
   - `dist/index.html` - å…¥å£æ–‡ä»¶
   - `dist/assets/*.js` - JavaScript åŒ…
   - `dist/assets/*.css` - æ ·å¼æ–‡ä»¶
   - å…¶ä»–é™æ€èµ„æº

---

## âœ… æ€»ç»“

**å½“å‰é—®é¢˜**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼€å‘æœåŠ¡å™¨  
**æ ¹æœ¬è§£å†³**ï¼šæ”¹ç”¨ç”Ÿäº§æ„å»ºç‰ˆæœ¬  
**æ‰§è¡Œå‘½ä»¤**ï¼š`bash deploy_frontend_production.sh`  
**é¢„æœŸæ•ˆæœ**ï¼šæ°¸è¿œä¸ä¼šå†å‡ºç°è“å±

---

**åˆ›å»ºæ—¶é—´**ï¼š2025-10-16  
**çŠ¶æ€**ï¼šå¾…å®æ–½  
**ä¼˜å…ˆçº§**ï¼šâ­â­â­â­â­ æœ€é«˜

